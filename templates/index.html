<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: #f8f8f8;
            color: #333;
        }
        header {
            font-size: 22px;
            font-weight: 600;
            z-index: 10;
        }

        .upload-box {
            background: white;
            padding: 20px 15px;
            border-bottom: 1px solid #ddd;
            text-align: center;
    display: flex;
    align-items: center;
    justify-content: space-between;
gap: 16px;
position: fixed;
    z-index: 10;
    width: -webkit-fill-available;
margin-top: -60px;
    height: 20px;
        }
        .upload-box input[type="file"] {
            margin: 12px 0;
            cursor: pointer;
        }



        .controls {
    display: flex;
    align-items: center;
        }
        .btn {
            background: #007aff;
            color: white;
            border: none;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
border-radius: 9999px;
    padding: 5px 25px;
display: flex;vertical-align: middle;
        }
        .btn:hover {
            background: #005ecb;
        }
        .btn:disabled {
            background: #a0a0a0;
            cursor: not-allowed;
        }

.upload-btn svg {
    display: flex;
    align-items: center;
    justify-content: center;
}


        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
            padding: 10px 12px;
    margin-top: 60px;
        }
        .gallery label.gallery-item {
            position: relative;
            display: block;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            cursor: pointer;
        }
        .gallery img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            user-select: none;
            border-radius: 8px;
        }

        .gallery input[type="checkbox"] {
            display: none;
            position: absolute;
            top: 8px;
            left: 8px;
            width: 22px;
            height: 22px;
            border-radius: 5px;
            border: 2px solid #007aff;
            background: white;
        }
        .select-mode .gallery input[type="checkbox"] {
            display: block;
        }
        .gallery input[type="checkbox"]:checked {
            background: #007aff;
            border-color: #005ecb;
        }

        /* Lightbox styles */
        #lightboxOverlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
        #lightboxOverlay.active {
            display: flex;
        }
        #lightboxOverlay img {
            max-width: 100vw;
            max-height: 90vh;
            transition: transform 0.3s ease;
            cursor: grab;
        }


        #closeBtn {
    top: 20px;
    right: 20px;
    z-index: 999999;
    position: fixed;
    font-size: xx-large;
    width: auto;
    padding: 5px 15px;
    background-color: red;
}
        #prevBtn { top: 50%; left: 20px; transform: translateY(-50%);      z-index: 100; position: fixed;}
        #nextBtn { top: 50%; right: 20px; transform: translateY(-50%);  position: fixed; }


    </style>
</head>
<body>








<div class="upload-box">




<form method="POST" enctype="multipart/form-data" class="upload-form" id="uploadForm">
  <label for="fileUpload" class="btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 489.4 489.4" width="25" height="25">
            <g>
                <path d="M382.4 422.75H277.4v-106.1h34.7c8.8 0 14-10 8.8-17.2l-67.5-93.4c-4.3-6-13.2-6-17.5 0l-67.5 93.4c-5.2 7.2-.1 17.2 8.8 17.2h34.7v106.1H94.3c-52.5-2.9-94.3-52-94.3-105.2 0-36.7 19.9-68.7 49.4-86-2.7-7.3-4.1-15.1-4.1-23.3 0-37.5 30.3-67.8 67.8-67.8 8.1 0 15.9 1.4 23.2 4.1 21.7-46 68.5-77.9 122.9-77.9 70.4.1 128.4 54 135 122.7 54.1 9.3 95.2 59.4 95.2 116.1 0 60.6-47.2 113.1-107 117.3z" fill="#ffffff"></path>
            </g>
        </svg></label>
  <input id="fileUpload" type="file" name="file" multiple accept="image/*" hidden>
</form>

<script>
  const fileInput = document.getElementById('fileUpload');
  const uploadForm = document.getElementById('uploadForm');

  fileInput.addEventListener('change', () => {
    if (fileInput.files.length === 0) return;

    const count = fileInput.files.length;
    const msg = count === 1
      ? "Upload this image?"
      : `Upload these ${count} images?`;

    if (confirm(msg)) {
      uploadForm.submit();
    } else {
      // Clear selection so user can pick again
      fileInput.value = "";
    }
  });
</script>







<header style="display: flex;flex-direction: column;">Gallery<sub style="font-size: small;">Total images: {{ total_images }}</sub>
</header>


    <div class="controls">
        <button id="toggleSelectBtn" type="button" class="btn"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" x="0" y="0" viewBox="0 0 682.667 682.667" style="enable-background:new 0 0 512 512" xml:space="preserve" class=""><g><defs><clipPath id="a" clipPathUnits="userSpaceOnUse"><path d="M0 512h512V0H0Z" fill="#fff" opacity="1" data-original="#fff"></path></clipPath></defs><g clip-path="url(#a)" transform="matrix(1.33333 0 0 -1.33333 0 682.667)"><path d="M0 0c6.582 11.096 10.361 24.05 10.361 37.886 0 41.069-33.293 74.362-74.362 74.362" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(319.971 296.188)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c-6.582 11.096-10.361 24.05-10.361 37.886 0 41.069 33.294 74.362 74.362 74.362" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(191.968 296.188)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c11.242 18.382 17.721 39.993 17.721 63.118 0 46.946-26.702 87.655-65.747 107.769" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(359.4 270.956)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c19.315 41.268 61.212 69.855 109.787 69.855" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(146.183 385.37)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c0-44.343 23.822-83.121 59.367-104.235" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(134.819 334.074)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c-8.087-19.673-12.546-41.22-12.546-63.809 0-45.736 18.282-87.202 47.938-117.488" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(100.577 397.883)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c-30.208 44.492-81.211 73.723-139.042 73.723-37.824 0-72.727-12.504-100.802-33.604" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(395.012 428.291)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c9.021 20.602 14.025 43.363 14.025 67.293 0 17.391-2.643 34.164-7.55 49.94" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(409.884 266.781)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v189.409c0 13.255 10.746 24 24 24v0c13.255 0 24-10.745 24-24V3.408" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(231.97 144.237)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v24.52c0 13.254 10.746 24 24 24v0c13.255 0 24-10.746 24-24V0" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(279.97 147.645)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v14.282c0 13.255 10.746 24 24 24v0c13.255 0 24-10.745 24-24V0" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(327.97 147.645)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v.52c0 13.254 10.746 24 24 24 13.255 0 24-10.746 24-24v-21.628" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(375.97 147.645)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v-53.404a95.071 95.071 0 0 0-24-63.147" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(423.97 126.537)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v-67.477c0-24.37 8.486-47.98 24-66.774" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(231.97 144.237)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="m0 0-63.784 110.476c-6.97 12.073-2.833 27.511 9.24 34.482s27.512 2.834 34.482-9.239l15.627-27.068" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(236.098 47.32)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v0" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(123.128 436.818)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path></g></g></svg></button>
        
<!--
<a class="btn" href="?logout=Yes" style="background: #e41a14;margin-left: 5px;vertical-align: middle;padding:5px 10px;" ><svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" x="0" y="0" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512" xml:space="preserve" class=""><g><path d="M363.335 488a24 24 0 0 1-24 24H113.082a80.09 80.09 0 0 1-80-80V80a80.09 80.09 0 0 1 80-80h226.253a24 24 0 0 1 0 48H113.082a32.035 32.035 0 0 0-32 32v352a32.034 32.034 0 0 0 32 32h226.253a24 24 0 0 1 24 24zm108.553-248.97L357.837 124.978a24 24 0 1 0-33.937 33.941L396.977 232H208.041a24 24 0 1 0 0 48h188.935l-73.08 73.08a24 24 0 1 0 33.941 33.941l114.051-114.05a24 24 0 0 0 0-33.941z" fill="#ffffff" opacity="1" data-original="#fff"></path></g></svg></a>
-->
    </div>


</div>



















<style>
.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 28px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: 0.4s;
  border-radius: 34px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 22px;
  width: 22px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: 0.4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: #4cd964; /* iOS green */
}

input:checked + .slider:before {
  transform: translateX(22px);
}
.slider.round {
  border-radius: 34px;
}
/* iOS-style floating action bar shown when items are selected */
.ios-action-bar {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 8px 16px calc(env(safe-area-inset-bottom) + 8px);
  background: rgba(250, 250, 250, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid rgba(0,0,0,0.1);
  display: none;            /* hidden by default */
  gap: 12px;
  justify-content: center;
  z-index: 2000;
    display: none;
    gap: 12px;
    justify-content: space-between;
    z-index: 2000;
    align-items: center;
height: 50px;
}

.ios-btn-pill {
  flex: 1;
  min-width: auto;
  padding: 14px 36px;
  font-size: 17px;
  font-weight: 600;
  line-height: 1;
  border: none;
  border-radius: 9999px;    /* full pill */
  cursor: pointer;
  transition: transform 0.08s ease, opacity 0.08s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}




#lightboxImage {
  transition: transform 0.2s ease;
  touch-action: none; /* Prevent default scrolling while touching image */
  cursor: grab;
}
#lightboxImage:active {
  cursor: grabbing;
}

</style>







<!-- Floating iOS-style action bar -->
<div class="ios-action-bar" aria-hidden="true" id="selectBar">

<div>
<label class="switch">
  <input type="checkbox" id="selectAllCheckbox">
  <span class="slider round"></span>
</label>
<span style="margin-left:10px;" for="selectAllCheckbox">Select All</span>
</div>

<form id="downloadForm" method="POST">
<div id="deletbar" style="display:none;">
  <!-- Download -->
  <button type="submit" 
          formaction="/test{{ url_for('download') }}"
          class="btn"
         >
    <!-- icon -->
    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 128 128">
      <path d="M128 65c0 15.439-12.563 28-28 28H80c-2.211 0-4-1.791-4-4s1.789-4 4-4h20c11.027 0 20-8.973 20-20s-8.973-20-20-20h-4c-2.211 0-4-1.791-4-4 0-15.439-12.563-28-28-28S36 25.561 36 41c0 2.209-1.789 4-4 4h-4C16.973 45 8 53.973 8 65s8.973 20 20 20h20c2.211 0 4 1.791 4 4s-1.789 4-4 4H28C12.563 93 0 80.439 0 65s12.563-28 28-28h.223C30.219 19.025 45.5 5 64 5s33.781 14.025 35.777 32H100c15.438 0 28 12.561 28 28zm-50.828 37.172L68 111.344V61c0-2.209-1.789-4-4-4s-4 1.791-4 4v50.344l-9.172-9.172c-1.563-1.563-4.094-1.563-5.656 0s-1.563 4.094 0 5.656l16 16c.781.781 1.805 1.172 2.828 1.172s2.047-.391 2.828-1.172l16-16c1.563-1.563 1.563-4.094 0-5.656s-4.094-1.563-5.656 0z" fill="currentColor"/>
    </svg>
  
  </button>
&nbsp;  <!-- Delete -->
  <button type="submit"
          formaction="/test{{ url_for('DeletSelected') }}"
          class="btn" style="background: red;"
          onclick="return confirm('Are you sure you want to delete the selected images? This action cannot be undone.');"
>
    <!-- icon -->
    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 512 512">
      <path d="m62.205 150 26.569 320.735C90.678 493.865 110.38 512 133.598 512h244.805c23.218 0 42.92-18.135 44.824-41.265L449.795 150H62.205zm118.781 302c-7.852 0-14.458-6.108-14.956-14.063l-15-242c-.513-8.276 5.771-15.395 14.033-15.908 8.569-.601 15.381 5.757 15.908 14.033l15 242c.531 8.57-6.25 15.938-14.985 15.938zM271 437c0 8.291-6.709 15-15 15s-15-6.709-15-15V195c0-8.291 6.709-15 15-15s15 6.709 15 15v242zm89.97-241.062-15 242c-.493 7.874-7.056 14.436-15.908 14.033-8.262-.513-14.546-7.632-14.033-15.908l15-242c.513-8.276 7.764-14.297 15.908-14.033 8.262.513 14.546 7.632 14.033 15.908zM451 60h-90V45c0-24.814-20.186-45-45-45H196c-24.814 0-45 20.186-45 45v15H61c-16.569 0-30 13.431-30 30 0 16.567 13.431 30 30 30h390c16.569 0 30-13.433 30-30 0-16.569-13.431-30-30-30zm-120 0H181V45c0-8.276 6.724-15 15-15h120c8.276 0 15 6.724 15 15v15z" fill="currentColor"/>
    </svg>  </button>
</div>
</form>

</div>

















<div class="gallery">
    {% for img in images %}
    <label class="gallery-item">
        <input type="checkbox" name="selected_images" form="downloadForm" value="{{ img }}">
        <img src="/test{{ url_for('static', filename='Uploads/' + img) }}" alt="Image">
    </label>
    {% endfor %}
</div>






<!-- Lightbox -->
<div id="lightboxOverlay">

    <div style="position:relative; text-align:center; width: 100%;">

<button id="closeBtn" class="btn" aria-label="Close">&times;</button>


<img id="lightboxImage" src="" alt="Fullscreen Image">

<!-- New buttons below the image -->
<div class="ios-action-bar" style="margin-top:10px; display:flex; justify-content:center; gap:12px;">


    <button id="prevBtn" class="btn">&#9664;</button>

<button id="downloadSingleBtn" class="btn" style="padding:8px 18px; font-size:16px;"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" x="0" y="0" viewBox="0 0 515.283 515.283" style="enable-background:new 0 0 512 512" xml:space="preserve" class=""><g><path d="M400.775 515.283H114.507c-30.584 0-59.339-11.911-80.968-33.54C11.911 460.117 0 431.361 0 400.775v-28.628c0-15.811 12.816-28.628 28.627-28.628s28.627 12.817 28.627 28.628v28.628c0 15.293 5.956 29.67 16.768 40.483 10.815 10.814 25.192 16.771 40.485 16.771h286.268c15.292 0 29.669-5.957 40.483-16.771 10.814-10.815 16.771-25.192 16.771-40.483v-28.628c0-15.811 12.816-28.628 28.626-28.628s28.628 12.817 28.628 28.628v28.628c0 30.584-11.911 59.338-33.54 80.968-21.629 21.629-50.384 33.54-80.968 33.54zM257.641 400.774a28.538 28.538 0 0 1-19.998-8.142l-.002-.002-.057-.056-.016-.016c-.016-.014-.03-.029-.045-.044l-.029-.029a.892.892 0 0 0-.032-.031l-.062-.062-114.508-114.509c-11.179-11.179-11.179-29.305 0-40.485 11.179-11.179 29.306-11.18 40.485 0l65.638 65.638V28.627C229.014 12.816 241.83 0 257.641 0s28.628 12.816 28.628 28.627v274.408l65.637-65.637c11.178-11.179 29.307-11.179 40.485 0 11.179 11.179 11.179 29.306 0 40.485L277.883 392.39l-.062.062-.032.031-.029.029c-.014.016-.03.03-.044.044l-.017.016a1.479 1.479 0 0 1-.056.056l-.002.002c-.315.307-.634.605-.96.895a28.441 28.441 0 0 1-7.89 4.995l-.028.012c-.011.004-.02.01-.031.013a28.5 28.5 0 0 1-11.091 2.229z" fill="#ffffff" opacity="1" data-original="#000000"></path></g></svg></button>

<button id="shareBtn" class="btn" style="padding:8px 18px; font-size:16px;"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" x="0" y="0" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512" xml:space="preserve" class=""><g><path d="M271.176 121.396C120.971 129.218.176 253.891.176 406v106l37.925-88.29c44.854-89.692 133.847-147.041 233.075-152.314v121.318L511.824 196 271.176 0z" fill="#ffffff" opacity="1" data-original="#000000"></path></g></svg></button>


    <button id="nextBtn" class="btn">&#9654;</button>

</div>

</div>

</div>





<script>
const lightboxImage = document.getElementById("lightboxImage");

let scale = 1;       // Current zoom level
let lastScale = 1;   // Used for pinch zoom
let isPinching = false;

let posX = 0, posY = 0; // Image position
let lastX = 0, lastY = 0;
let isDragging = false;
let startX, startY;

// Get distance between two touch points
function getDistance(touches) {
  const [touch1, touch2] = touches;
  const dx = touch1.clientX - touch2.clientX;
  const dy = touch1.clientY - touch2.clientY;
  return Math.sqrt(dx * dx + dy * dy);
}

// Apply transform (zoom + pan)
function updateTransform() {
  lightboxImage.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
}

// --- Pinch Zoom (Touch) ---
lightboxImage.addEventListener("touchstart", (e) => {
  if (e.touches.length === 2) {
    isPinching = true;
    lastScale = scale;
    startDistance = getDistance(e.touches);
  } else if (e.touches.length === 1 && scale > 1) {
    isDragging = true;
    startX = e.touches[0].clientX - lastX;
    startY = e.touches[0].clientY - lastY;
  }
});

lightboxImage.addEventListener("touchmove", (e) => {
  if (isPinching && e.touches.length === 2) {
    const newDistance = getDistance(e.touches);
    scale = Math.min(Math.max(1, lastScale * (newDistance / startDistance)), 4);
    updateTransform();
  } else if (isDragging && e.touches.length === 1) {
    posX = e.touches[0].clientX - startX;
    posY = e.touches[0].clientY - startY;
    lastX = posX;
    lastY = posY;
    updateTransform();
  }
});

lightboxImage.addEventListener("touchend", () => {
  isPinching = false;
  isDragging = false;
});

// --- Mouse Drag for Desktop ---
lightboxImage.addEventListener("mousedown", (e) => {
  if (scale > 1) {
    isDragging = true;
    startX = e.clientX - lastX;
    startY = e.clientY - lastY;
  }
});

document.addEventListener("mousemove", (e) => {
  if (isDragging) {
    posX = e.clientX - startX;
    posY = e.clientY - startY;
    lastX = posX;
    lastY = posY;
    updateTransform();
  }
});

document.addEventListener("mouseup", () => {
  isDragging = false;
});

// --- Mouse Wheel Zoom ---
lightboxImage.addEventListener("wheel", (e) => {
  e.preventDefault();
  let zoom = scale + e.deltaY * -0.001;
  scale = Math.min(Math.max(1, zoom), 4);
  updateTransform();
});





function resetImage() {
  scale = 1;      // reset zoom
  posX = 0;       // reset position
  posY = 0;
  lastX = 0;
  lastY = 0;
  updateTransform(); // apply reset
}




















const selectAllCheckbox = document.getElementById('selectAllCheckbox');
const imageCheckboxes = document.querySelectorAll('input[name="selected_images"]');
    const deletbar = document.getElementById('deletbar');

selectAllCheckbox.addEventListener('change', function() {
    imageCheckboxes.forEach(cb => cb.checked = this.checked);
const anyChecked = [...imageCheckboxes].some(c => c.checked);
    deletbar.style.display = anyChecked ? 'flex' : 'none';
});

imageCheckboxes.forEach(cb => {
    cb.addEventListener('change', function() {
        if (!this.checked) {
            selectAllCheckbox.checked = false;
        } else if (Array.from(imageCheckboxes).every(cb => cb.checked)) {
            selectAllCheckbox.checked = true;
        }
    });
});
</script>

<script>
    const toggleSelectBtn = document.getElementById('toggleSelectBtn');
    const selectBar = document.getElementById('selectBar');
    const gallery = document.querySelector('.gallery');
    const galleryLabels = document.querySelectorAll('.gallery label.gallery-item');
    const checkboxes = document.querySelectorAll('.gallery input[type="checkbox"]');
    let selectMode = false;

toggleSelectBtn.addEventListener('click', () => {
    selectMode = !selectMode;
    document.body.classList.toggle('select-mode', selectMode);
    selectBar.style.display = selectMode ? 'flex' : 'none';
    toggleSelectBtn.innerHTML = selectMode ? '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" x="0" y="0" viewBox="0 0 64 64" style="enable-background:new 0 0 512 512" xml:space="preserve" class=""><g><path d="M40.12 27.2c-7.01 0-12.71-5.7-12.71-12.71 0-2.6.78-5.09 2.25-7.21.88-1.28 1.98-2.37 3.26-3.26 2.12-1.46 4.61-2.24 7.21-2.24 7.01 0 12.71 5.7 12.71 12.71 0 2.58-.77 5.08-2.24 7.21a12.63 12.63 0 0 1-3.26 3.26 12.755 12.755 0 0 1-7.22 2.24zm0-23.42c-2.19 0-4.29.65-6.07 1.88-1.08.75-2 1.67-2.75 2.75a10.608 10.608 0 0 0-1.89 6.07c0 5.9 4.81 10.71 10.71 10.71 2.18 0 4.28-.65 6.08-1.89 1.08-.74 2-1.67 2.75-2.75 1.23-1.79 1.88-3.9 1.88-6.07 0-5.9-4.8-10.7-10.71-10.7z" fill="#ffffff" opacity="1" data-original="#000000" class=""></path><path d="M46.77 25.13c-.32 0-.63-.15-.82-.43-.31-.45-.2-1.08.25-1.39 1.08-.75 2-1.67 2.75-2.75.31-.45.94-.57 1.39-.25.45.31.57.94.25 1.39a12.71 12.71 0 0 1-3.25 3.25.96.96 0 0 1-.57.18zM46.97 19.33c-.26 0-.52-.1-.71-.29L35.58 8.35c-.22-.22-.33-.53-.28-.84s.23-.58.5-.74a8.834 8.834 0 0 1 4.33-1.14c4.88 0 8.85 3.97 8.85 8.85 0 1.52-.39 3.01-1.13 4.33-.15.27-.43.46-.74.5-.05.02-.1.02-.14.02zM38.02 7.97l8.62 8.62a6.854 6.854 0 0 0-8.62-8.62zM40.12 23.34c-4.88 0-8.85-3.97-8.85-8.85 0-1.52.39-3.02 1.13-4.34.15-.27.43-.46.74-.5.31-.05.62.06.84.28l10.69 10.69c.22.22.33.53.28.84s-.23.58-.5.74c-1.3.74-2.8 1.14-4.33 1.14zM33.6 12.38c-.22.68-.33 1.39-.33 2.11 0 3.78 3.08 6.85 6.85 6.85.72 0 1.43-.11 2.1-.33zM43.12 62.22c-1.34 0-2.61-.52-3.56-1.47l-2.29-2.29c-.89-.9-2.23-1.17-3.41-.7l-7.27 2.92c-1.71.68-3.62.6-5.26-.23a6.402 6.402 0 0 1-3.32-4.08L11.34 31.5c-.47-1.74.02-3.53 1.29-4.81a4.925 4.925 0 0 1 4.81-1.29l24.87 6.67c1.77.47 3.26 1.68 4.08 3.32s.9 3.56.22 5.27l-2.91 7.27a3.15 3.15 0 0 0 .7 3.41l2.29 2.29c.95.95 1.48 2.22 1.48 3.56s-.52 2.61-1.48 3.56c-.96.94-2.22 1.47-3.57 1.47zm-8.08-6.69c1.34 0 2.66.52 3.65 1.51l2.29 2.29c1.15 1.15 3.15 1.15 4.29 0 .57-.57.89-1.33.89-2.15s-.32-1.57-.89-2.15l-2.29-2.29a5.16 5.16 0 0 1-1.14-5.57l2.91-7.27c.47-1.18.42-2.5-.15-3.63s-1.59-1.96-2.81-2.28l-24.87-6.67c-1.04-.28-2.11.01-2.87.77s-1.05 1.84-.77 2.88l6.67 24.87a4.428 4.428 0 0 0 2.28 2.81c1.13.57 2.45.62 3.62.16l7.27-2.92c.62-.24 1.27-.36 1.92-.36z" fill="#ffffff" opacity="1" data-original="#000000" class=""></path></g></svg>' : '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" x="0" y="0" viewBox="0 0 682.667 682.667" style="enable-background:new 0 0 512 512" xml:space="preserve" class=""><g><defs><clipPath id="a" clipPathUnits="userSpaceOnUse"><path d="M0 512h512V0H0Z" fill="#fff" opacity="1" data-original="#fff"></path></clipPath></defs><g clip-path="url(#a)" transform="matrix(1.33333 0 0 -1.33333 0 682.667)"><path d="M0 0c6.582 11.096 10.361 24.05 10.361 37.886 0 41.069-33.293 74.362-74.362 74.362" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(319.971 296.188)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c-6.582 11.096-10.361 24.05-10.361 37.886 0 41.069 33.294 74.362 74.362 74.362" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(191.968 296.188)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c11.242 18.382 17.721 39.993 17.721 63.118 0 46.946-26.702 87.655-65.747 107.769" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(359.4 270.956)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c19.315 41.268 61.212 69.855 109.787 69.855" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(146.183 385.37)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c0-44.343 23.822-83.121 59.367-104.235" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(134.819 334.074)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c-8.087-19.673-12.546-41.22-12.546-63.809 0-45.736 18.282-87.202 47.938-117.488" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(100.577 397.883)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c-30.208 44.492-81.211 73.723-139.042 73.723-37.824 0-72.727-12.504-100.802-33.604" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(395.012 428.291)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0c9.021 20.602 14.025 43.363 14.025 67.293 0 17.391-2.643 34.164-7.55 49.94" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(409.884 266.781)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v189.409c0 13.255 10.746 24 24 24v0c13.255 0 24-10.745 24-24V3.408" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(231.97 144.237)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v24.52c0 13.254 10.746 24 24 24v0c13.255 0 24-10.746 24-24V0" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(279.97 147.645)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v14.282c0 13.255 10.746 24 24 24v0c13.255 0 24-10.745 24-24V0" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(327.97 147.645)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v.52c0 13.254 10.746 24 24 24 13.255 0 24-10.746 24-24v-21.628" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(375.97 147.645)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v-53.404a95.071 95.071 0 0 0-24-63.147" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(423.97 126.537)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v-67.477c0-24.37 8.486-47.98 24-66.774" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(231.97 144.237)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="m0 0-63.784 110.476c-6.97 12.073-2.833 27.511 9.24 34.482s27.512 2.834 34.482-9.239l15.627-27.068" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(236.098 47.32)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path><path d="M0 0v0" style="stroke-width:20;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" transform="translate(123.128 436.818)" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-dasharray="none" stroke-opacity="" data-original="#fff"></path></g></g></svg>';

    // Close lightbox if switching to select mode
    if (selectMode && overlay.classList.contains('active')) {
        overlay.classList.remove('active');
    }

    if (!selectMode) {
        checkboxes.forEach(cb => cb.checked = false);
    }
});

// Show or hide Download button based on selection
checkboxes.forEach(cb => cb.addEventListener('change', () => {
    const anyChecked = [...checkboxes].some(c => c.checked);
    deletbar.style.display = anyChecked ? 'flex' : 'none';
}));

    // Lightbox logic
    const overlay = document.getElementById('lightboxOverlay');

    const closeBtn = document.getElementById('closeBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const images = Array.from(document.querySelectorAll('.gallery img'));
    let currentIndex = 0;

galleryLabels.forEach((label, index) => {
    const img = label.querySelector('img');
    img.addEventListener('click', e => {
        e.preventDefault();
        if (selectMode) {
            // Toggle selection
            const checkbox = label.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
        } else {
            // Normal mode: open fullscreen
            currentIndex = index;
            showImage();
            overlay.classList.add('active');
        }
    });
});

    function showImage() {
        lightboxImage.src = images[currentIndex].src;
    }

    closeBtn.onclick = () => {resetImage(); overlay.classList.remove('active');};
    prevBtn.onclick = () => {resetImage(); currentIndex = (currentIndex - 1 + images.length) % images.length; showImage(); };
    nextBtn.onclick = () => {resetImage(); currentIndex = (currentIndex + 1) % images.length; showImage(); };



const downloadSingleBtn = document.getElementById('downloadSingleBtn');
const shareBtn = document.getElementById('shareBtn');

downloadSingleBtn.addEventListener('click', () => {
    const url = images[currentIndex].src;
    // Create a temporary link and click it to trigger download
    const a = document.createElement('a');
    a.href = url;
    a.download = url.split('/').pop();  // filename from URL
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
});

shareBtn.addEventListener('click', async () => {
    const url = images[currentIndex].src;

    if (navigator.share) {
        try {
            await navigator.share({
                title: 'Shared Image',
                text: 'Check out this image!',
                url: url,
            });
            console.log('Image shared successfully');
        } catch (err) {
            alert('Share cancelled or failed');
        }
    } else {
        alert('Sharing not supported on this browser');
    }
});

</script>
</body>
</html>
